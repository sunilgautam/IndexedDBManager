!function(a,b,c){"use strict";function d(a,b){this.database=this.request=null,this.dbName=c===a?"testDB":a,this.dbVersion=c===b?1:b}d.prototype.init=function(a,b){this.dbName=c===a?this.dbName:a,this.dbVersion=c===b?this.dbVersion:b},d.prototype.openDatabase=function(b,c,d){this.request=a.indexedDB.open(this.dbName,this.dbVersion),this.request.onsuccess=b,this.request.onerror=c,this.request.onupgradeneeded=d},d.prototype.getDatabase=function(a,b){var c,d=Array.prototype.slice.call(arguments).slice(2);this.database?b.apply(this,d):(c=this,this.openDatabase(function(a){c.database=a.target.result,b.apply(c,d)},function(a){console.log(a.target.errorCode)},function(b){var c=b.target.result;c.createObjectStore(a,{keyPath:"id",autoIncrement:!0})}))},d.prototype.save=function(a,b,d,e){c===d&&(d=function(){}),c===e&&(e=function(){});var f=function(){var c=this.database.transaction([b],"readwrite"),f=c.objectStore(b),g=f.put(a);g.onsuccess=d,g.onerror=e};this.getDatabase(b,f)},d.prototype.read=function(a,b,d,e){var f;c===d&&(d=function(){}),c===e&&(e=function(){}),f="function"==typeof a?a:function(b){return b.id==a};var g=function(){var c=this.database.transaction([b],"readwrite"),g=c.objectStore(b),h=g.openCursor(),i=[];h.onsuccess=function(b){var c=b.target.result;c?((!a||f.call(null,c.value))&&i.push(c.value),c["continue"]()):d.call(null,i)},h.onerror=e};this.getDatabase(b,g)},d.prototype.update=function(a,b,d,e,f){var g,h;c===e&&(e=function(){}),c===f&&(f=function(){}),g="function"==typeof b?b:function(a){var c;for(c in b)b.hasOwnProperty(c)&&(a[c]=b[c]);return a};var i=function(a){var b=this.database.transaction([d],"readwrite"),c=b.objectStore(d),h=c.put(g.call(null,a));h.onsuccess=e,h.onerror=f};h=this,this.read(a,d,function(a){a.length&&h.getDatabase(d,i,a[0])},f)},d.prototype["delete"]=function(a,b,d,e){var f;c===d&&(d=function(){}),c===e&&(e=function(){}),f="[object Object]"===Object.prototype.toString.call(a)?a.id:a;var g=function(){var a=this.database.transaction([b],"readwrite"),c=a.objectStore(b),g=c["delete"](f);g.onsuccess=d,g.onerror=e};this.getDatabase(b,g)},a.IndexDBManager=new d}(window,document);